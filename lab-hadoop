# update system
yum clean all
yum -y install epel-release
yum -y update

# install java and wget
yum install -y wget java
java -version

# config ip
vi /etc/hosts

-------------------------------------
192.168.0.7 edge.ts.com edge

192.168.0.9 master1.ts.com master1
192.168.0.3 master2.ts.com master2

192.168.0.30 worker1.ts.com worker1
192.168.0.12 worker2.ts.com worker2
192.168.0.5 worker3.ts.com worker3
-------------------------------------

# set hostname should once per cmd

hostnamectl set-hostname edge.ts.com

ssh master1 hostnamectl set-hostname master1.ts.com
ssh master2 hostnamectl set-hostname master2.ts.com

ssh worker1 hostnamectl set-hostname worker1.ts.com
ssh worker2 hostnamectl set-hostname worker2.ts.com
ssh worker3 hostnamectl set-hostname worker3.ts.com

# create hosts file on /home/ 
cd /home/
vi hosts

---------
master1
master2
worker1
worker2
worker3
---------

# install pdsh - can run multiple remote commands in parallel from single remote host.
yum install -y pdsh

#However, you may have issue about permission denied when run pdsh to remote on the other server
#Use on main server is enough and run once per cmd
ssh-keygen

cat ~/.ssh/id_rsa.pub | ssh master1 'cat >> .ssh/authorized_keys'
cat ~/.ssh/id_rsa.pub | ssh master2 'cat >> .ssh/authorized_keys'

cat ~/.ssh/id_rsa.pub | ssh worker1 'cat >> .ssh/authorized_keys'
cat ~/.ssh/id_rsa.pub | ssh worker2 'cat >> .ssh/authorized_keys'
cat ~/.ssh/id_rsa.pub | ssh worker3 'cat >> .ssh/authorized_keys'

#test pdsh one target node again - dir is /home/
pdsh -w master1 hostname 
#master1: master1.ts.com -it's working fine

pdsh -w ^hosts hostname
#worker3: worker3.ts.com
#master1: master1.ts.com
#worker2: worker2.ts.com
#worker1: worker1.ts.com
#master2: master2.ts.com

#Create dir /root/bin along with script file 'pscp
mkdir /root/bin
cd /root/bin
vi pscp

-------------------------------
#!/bin/sh
for i in `cat /root/hosts`
do
scp $1 ${i}:$1
done
-------------------------------

#config permission setting to exececute
chmod +x /root/bin/pscp 
#from -rw-r--r--. to -rwxr-xr-x.

#Send /etc/hosts to all nodes
pscp /etc/hosts

#Optional : you can check /etc/hosts which the results is same
ssh master1 cat /etc/hosts
ssh master2 cat /etc/hosts
ssh worker1 cat /etc/hosts
ssh worker2 cat /etc/hosts 
ssh worker3 cat /etc/hosts
